import { Button, VerticalBox, HorizontalBox } from "std-widgets.slint";
import { ToolBar } from "components/toolbar.slint";
import { FloatingLayersPanel } from "components/floating_panel.slint";
import { StatusBar } from "components/statusbar.slint";
import { SettingsDialog } from "components/settings.slint";
import { MenuBar } from "components/menu_bar.slint";

// Exportar SplashScreen para uso no Rust
export { SplashScreen } from "components/splash.slint";

// Janela principal
export component MainWindow inherits Window {
    title: "Rust GUI - Sistema Profissional";
    preferred-width: 1400px;
    preferred-height: 900px;
    min-width: 1000px;
    min-height: 700px;
    icon: @image-url("../icon.svg");
    
    // Callbacks públicos para serem chamados do Rust
    callback quit-app();
    public function show-settings-dialog() {
        show-settings = true;
    }
    
    // Estado interno para controlar exibição das configurações
    property <bool> show-settings: false;
    
    // Layout principal
    Rectangle {
        background: #ecf0f1;
        
        // MenuBar customizado com callbacks (posicionado absolutamente no topo)
        custom-menubar := MenuBar {
            width: 100%;
            y: 0px;
            z: 100; // Garantir que fique acima de tudo
            
            menu-quit => {
                root.quit-app();
            }
            
            menu-settings => {
                root.show-settings = true;
            }
        }
        
        VerticalLayout {
            padding: 0px;
            spacing: 0px;
            
            // Espaço para o MenuBar
            Rectangle {
                height: 40px;
            }
            
            // Toolbar
            toolbar := ToolBar {
                new-project => {
                    debug("Novo Projeto");
                }
                
                open-project => {
                    debug("Abrir Projeto");
                }
                
                save-project => {
                    debug("Salvar Projeto");
                }
                
                undo => {
                    debug("Desfazer");
                }
                
                redo => {
                    debug("Refazer");
                }
                
                zoom-in => {
                    debug("Zoom In");
                }
                
                zoom-out => {
                    debug("Zoom Out");
                }
                
                zoom-extent => {
                    debug("Zoom Extent");
                }
                
                pan => {
                    debug("Pan");
                }
                
                select => {
                    debug("Selecionar");
                }
                
                measure => {
                    debug("Medir");
                }
                
                draw-point => {
                    debug("Desenhar Ponto");
                }
                
                draw-line => {
                    debug("Desenhar Linha");
                }
                
                draw-polygon => {
                    debug("Desenhar Polígono");
                }
            }
            
            // Área principal
            HorizontalLayout {
                vertical-stretch: 1;
                spacing: 0px;
                
                Rectangle {
                    background: #ffffff;
                    horizontal-stretch: 1;
                }
            }
            
            // Barra de status (coordenadas movidas para cá, como no QGIS)
            statusbar := StatusBar {
                coordinates: "X: 0.000  Y: 0.000";
                scale: "1:50000";
                crs: "EPSG:31983";
                message: "Pronto";
            }
        }
        
        // Painel flutuante de camadas (sobreposto na janela)
        floating-layers := FloatingLayersPanel {
            layers: [
                "Camada de Pontos",
                "Camada de Linhas",
                "Camada de Polígonos",
                "Mapa Base",
                "Imagem de Satélite"
            ];
        }
        
        // Janela de configurações (dialog modal)
        if root.show-settings: settings-dialog := SettingsDialog {
            apply-settings => {
                debug("Aplicar configurações");
                root.show-settings = false;
            }
            
            cancel-settings => {
                debug("Cancelar configurações");
                root.show-settings = false;
            }
        }
        
    }
}
