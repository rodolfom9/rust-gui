import { Button, VerticalBox, HorizontalBox } from "std-widgets.slint";
import { ToolBar } from "components/toolbar.slint";
import { StatusBar } from "components/statusbar.slint";
import { SettingsDialog } from "components/settings.slint";
import { MenuBar } from "components/menu_bar.slint";
import { AboutDialog } from "components/about.slint";
import { AddPluginsDialog } from "components/plugins.slint";
import { SandwichPanel } from "components/sandwich_panel.slint";

// Exportar SplashScreen para uso no Rust
export { SplashScreen } from "components/splash.slint";

// Janela principal
export component MainWindow inherits Window {
    title: "Rust GUI - Sistema Profissional";
    preferred-width: 1400px;
    preferred-height: 900px;
    min-width: 1000px;
    min-height: 700px;
    icon: @image-url("../icon.svg");
    
    // Callbacks públicos para serem chamados do Rust
    callback quit-app();
    
    public function show-settings-dialog() {
        show-settings = true;
    }
    
    public function show-about-dialog() {
        show-about = true;
    }
    
    public function show-plugins-dialog() {
        show-plugins = true;
    }
    
    // Estado interno para controlar exibição dos diálogos
    property <bool> show-settings: false;
    property <bool> show-about: false;
    property <bool> show-plugins: false;
    
    // Layout principal
    Rectangle {
        background: #ecf0f1;
        
        // MenuBar customizado com callbacks (posicionado absolutamente no topo)
        custom-menubar := MenuBar {
            width: 100%;
            y: 0px;
            z: 100; // Garantir que fique acima de tudo
            
            menu-quit => {
                root.quit-app();
            }
            
            menu-settings => {
                root.show-settings = true;
            }
            
            menu-about => {
                root.show-about = true;
            }
            
            menu-add-plugins => {
                root.show-plugins = true;
            }
        }
        
        VerticalLayout {
            padding: 0px;
            spacing: 0px;
            
            // Espaço para o MenuBar
            // TAMANHO: 36px (altura do MenuBar superior reduzido)
            Rectangle {
                height: 36px;
            }
            
            // Toolbar
            // TAMANHO: 48px (altura definida no componente ToolBar)
            toolbar := ToolBar {
                new-project => {
                    debug("Novo Projeto");
                }
                
                open-project => {
                    debug("Abrir Projeto");
                }
                
                save-project => {
                    debug("Salvar Projeto");
                }
                
                undo => {
                    debug("Desfazer");
                }
                
                redo => {
                    debug("Refazer");
                }
                
                zoom-in => {
                    debug("Zoom In");
                }
                
                zoom-out => {
                    debug("Zoom Out");
                }
                
                zoom-extent => {
                    debug("Zoom Extent");
                }
                
                pan => {
                    debug("Pan");
                }
                
                select => {
                    debug("Selecionar");
                }
                
                measure => {
                    debug("Medir");
                }
                
                draw-point => {
                    debug("Desenhar Ponto");
                }
                
                draw-line => {
                    debug("Desenhar Linha");
                }
                
                draw-polygon => {
                    debug("Desenhar Polígono");
                }
            }
            
            // Área principal
            HorizontalLayout {
                vertical-stretch: 1;
                spacing: 0px;
                
                // Painel lateral sanduíche
                sandwich-panel := SandwichPanel {
                    tab-changed(index) => {
                        debug("Aba alterada: " + index);
                    }
                }
                
                // Área de conteúdo principal (canvas)
                Rectangle {
                    background: #ffffff;
                    horizontal-stretch: 1;
                    
                    // Texto de placeholder
                    Text {
                        text: "Área de Trabalho Principal";
                        color: #95a5a6;
                        font-size: 24px;
                        font-weight: 300;
                        x: (parent.width - self.width) / 2;
                        y: (parent.height - self.height) / 2;
                    }
                }
            }
            
            // Barra de status (coordenadas movidas para cá, como no QGIS)
            statusbar := StatusBar {
                coordinates: "X: 0.000  Y: 0.000";
                scale: "1:50000";
                crs: "EPSG:31983";
                message: "Pronto";
            }
        }
        
        // Janela de configurações (dialog modal)
        if root.show-settings: settings-dialog := SettingsDialog {
            apply-settings => {
                debug("Aplicar configurações");
                root.show-settings = false;
            }
            
            cancel-settings => {
                debug("Cancelar configurações");
                root.show-settings = false;
            }
        }
        
        // Janela Sobre (dialog modal)
        if root.show-about: about-dialog := AboutDialog {
            close => {
                root.show-about = false;
            }
        }
        
        // Janela de Complementos (dialog modal)
        if root.show-plugins: plugins-dialog := AddPluginsDialog {
            close => {
                root.show-plugins = false;
            }
            
            install-plugin(index) => {
                debug("Instalar plugin: " + index);
            }
            
            uninstall-plugin(index) => {
                debug("Desinstalar plugin: " + index);
            }
            
            search-plugins(query) => {
                debug("Buscar plugins: " + query);
            }
        }
        
    }
}
