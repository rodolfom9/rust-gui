import { Button, VerticalBox, HorizontalBox, ScrollView, LineEdit, ListView, StandardListView } from "std-widgets.slint";

export struct Plugin {
    name: string,
    version: string,
    description: string,
    author: string,
    installed: bool,
}

export component AddPluginsDialog inherits Rectangle {
    callback close();
    callback install-plugin(int);
    callback uninstall-plugin(int);
    callback search-plugins(string);
    
    in property <[Plugin]> available-plugins: [
        { name: "Calculadora Geogr√°fica", version: "1.0.0", description: "Ferramenta para c√°lculos geogr√°ficos avan√ßados", author: "GeoTools Team", installed: false },
        { name: "Importador CSV", version: "2.1.3", description: "Importa dados de arquivos CSV para camadas vetoriais", author: "DataImport Inc", installed: true },
        { name: "Gerador de Relat√≥rios", version: "1.5.0", description: "Cria relat√≥rios personalizados em PDF", author: "ReportGen", installed: false },
        { name: "An√°lise de Terreno", version: "3.2.1", description: "Ferramentas avan√ßadas de an√°lise de relevo e topografia", author: "TerrainLab", installed: false },
        { name: "Geocodificador", version: "1.8.2", description: "Converte endere√ßos em coordenadas geogr√°ficas", author: "GeoCode Pro", installed: true },
    ];
    
    property <string> search-text: "";
    
    width: 100%;
    height: 100%;
    
    // Overlay semi-transparente
    background: #00000080;
    
    // TouchArea para fechar ao clicar fora (deve estar antes do di√°logo)
    TouchArea {
        width: 100%;
        height: 100%;
        clicked => {
            // N√£o fecha ao clicar fora para evitar perda acidental
        }
    }
    
    // Janela do di√°logo
    dialog-window := Rectangle {
        width: 900px;
        height: 650px;
        x: (parent.width - self.width) / 2;
        y: (parent.height - self.height) / 2;
        
        background: white;
        border-radius: 8px;
        drop-shadow-blur: 20px;
        drop-shadow-color: #00000040;
        
        // TouchArea para bloquear cliques no fundo
        TouchArea {
            width: 100%;
            height: 100%;
        }
        
        VerticalLayout {
            padding: 0px;
            spacing: 0px;
            
            // Header
            header := Rectangle {
                height: 80px;
                background: @linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                border-radius: 8px;
                
                HorizontalLayout {
                    padding: 20px;
                    spacing: 15px;
                    alignment: space-between;
                    
                    VerticalLayout {
                        spacing: 5px;
                        vertical-stretch: 1;
                        
                        Text {
                            text: "Gerenciar Complementos";
                            font-size: 22px;
                            font-weight: 700;
                            color: white;
                        }
                        
                        Text {
                            text: "Adicione ou remova complementos para estender as funcionalidades";
                            font-size: 12px;
                            color: #bdc3c7;
                        }
                    }
                    
                    // √çcone
                    Rectangle {
                        width: 40px;
                        height: 40px;
                        background: #3498db;
                        border-radius: 20px;
                        
                        Text {
                            text: "üì¶";
                            font-size: 24px;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                    }
                }
            }
            
            // Barra de busca
            search-bar := Rectangle {
                height: 60px;
                background: #f8f9fa;
                
                HorizontalLayout {
                    padding-left: 20px;
                    padding-right: 20px;
                    padding-top: 15px;
                    padding-bottom: 15px;
                    spacing: 10px;
                    
                    LineEdit {
                        placeholder-text: "Buscar complementos...";
                        text: root.search-text;
                        horizontal-stretch: 1;
                        edited(new-text) => {
                            root.search-text = new-text;
                            root.search-plugins(new-text);
                        }
                    }
                    
                    Button {
                        text: "üîç Buscar";
                        clicked => {
                            root.search-plugins(root.search-text);
                        }
                    }
                    
                    Button {
                        text: "üîÑ Atualizar";
                        clicked => {
                            debug("Atualizar lista de complementos");
                        }
                    }
                }
            }
            
            // Abas
            tabs := Rectangle {
                height: 50px;
                background: white;
                
                // Linha inferior
                Rectangle {
                    y: parent.height - 1px;
                    height: 1px;
                    background: #ecf0f1;
                }
                
                HorizontalLayout {
                    padding-left: 20px;
                    padding-right: 20px;
                    spacing: 5px;
                    
                    tab-all := Rectangle {
                        width: 150px;
                        height: 50px;
                        background: #3498db;
                        
                        Text {
                            text: "Todos";
                            font-size: 14px;
                            font-weight: 600;
                            color: white;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                debug("Aba Todos");
                            }
                        }
                    }
                    
                    tab-installed := Rectangle {
                        width: 150px;
                        height: 50px;
                        background: #ecf0f1;
                        
                        Text {
                            text: "Instalados";
                            font-size: 14px;
                            font-weight: 600;
                            color: #7f8c8d;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                debug("Aba Instalados");
                            }
                        }
                    }
                    
                    tab-available := Rectangle {
                        width: 150px;
                        height: 50px;
                        background: #ecf0f1;
                        
                        Text {
                            text: "Dispon√≠veis";
                            font-size: 14px;
                            font-weight: 600;
                            color: #7f8c8d;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                        
                        TouchArea {
                            clicked => {
                                debug("Aba Dispon√≠veis");
                            }
                        }
                    }
                }
            }
            
            // Lista de complementos
            ScrollView {
                vertical-stretch: 1;
                
                VerticalLayout {
                    padding: 20px;
                    spacing: 15px;
                    
                    for plugin[index] in root.available-plugins: Rectangle {
                        height: 120px;
                        background: white;
                        border-width: 1px;
                        border-color: #ecf0f1;
                        border-radius: 8px;
                        drop-shadow-blur: 5px;
                        drop-shadow-color: #00000010;
                        
                        HorizontalLayout {
                            padding: 20px;
                            spacing: 15px;
                            
                            // √çcone do plugin
                            Rectangle {
                                width: 80px;
                                height: 80px;
                                background: @linear-gradient(135deg, #3498db 0%, #2980b9 100%);
                                border-radius: 8px;
                                
                                Text {
                                    text: "üîå";
                                    font-size: 40px;
                                    horizontal-alignment: center;
                                    vertical-alignment: center;
                                }
                            }
                            
                            // Informa√ß√µes do plugin
                            VerticalLayout {
                                spacing: 5px;
                                horizontal-stretch: 1;
                                
                                HorizontalLayout {
                                    spacing: 10px;
                                    
                                    Text {
                                        text: plugin.name;
                                        font-size: 16px;
                                        font-weight: 700;
                                        color: #2c3e50;
                                    }
                                    
                                    Rectangle {
                                        width: 60px;
                                        height: 22px;
                                        background: plugin.installed ? #27ae60 : #95a5a6;
                                        border-radius: 4px;
                                        
                                        Text {
                                            text: plugin.installed ? "‚úì Instalado" : "Dispon√≠vel";
                                            font-size: 10px;
                                            font-weight: 600;
                                            color: white;
                                            horizontal-alignment: center;
                                            vertical-alignment: center;
                                        }
                                    }
                                }
                                
                                Text {
                                    text: "v" + plugin.version + " ‚Ä¢ " + plugin.author;
                                    font-size: 12px;
                                    color: #95a5a6;
                                }
                                
                                Text {
                                    text: plugin.description;
                                    font-size: 13px;
                                    color: #7f8c8d;
                                    wrap: word-wrap;
                                }
                            }
                            
                            // Bot√µes de a√ß√£o
                            VerticalLayout {
                                spacing: 10px;
                                alignment: center;
                                
                                if plugin.installed: Button {
                                    text: "Desinstalar";
                                    clicked => {
                                        root.uninstall-plugin(index);
                                    }
                                }
                                
                                if !plugin.installed: Button {
                                    text: "Instalar";
                                    primary: true;
                                    clicked => {
                                        root.install-plugin(index);
                                    }
                                }
                                
                                Button {
                                    text: "Detalhes";
                                    clicked => {
                                        debug("Ver detalhes do plugin");
                                    }
                                }
                            }
                        }
                        
                        // Efeito hover
                        TouchArea {
                            mouse-cursor: pointer;
                        }
                    }
                }
            }
            
            // Footer com estat√≠sticas e bot√£o fechar
            footer := Rectangle {
                height: 70px;
                background: #f8f9fa;
                border-radius: 8px;
                
                HorizontalLayout {
                    padding: 20px;
                    spacing: 20px;
                    alignment: space-between;
                    
                    HorizontalLayout {
                        spacing: 30px;
                        
                        HorizontalLayout {
                            spacing: 5px;
                            
                            Text {
                                text: "Total:";
                                font-size: 13px;
                                color: #7f8c8d;
                            }
                            
                            Text {
                                text: "5";
                                font-size: 13px;
                                font-weight: 700;
                                color: #2c3e50;
                            }
                        }
                        
                        HorizontalLayout {
                            spacing: 5px;
                            
                            Text {
                                text: "Instalados:";
                                font-size: 13px;
                                color: #7f8c8d;
                            }
                            
                            Text {
                                text: "2";
                                font-size: 13px;
                                font-weight: 700;
                                color: #27ae60;
                            }
                        }
                        
                        HorizontalLayout {
                            spacing: 5px;
                            
                            Text {
                                text: "Dispon√≠veis:";
                                font-size: 13px;
                                color: #7f8c8d;
                            }
                            
                            Text {
                                text: "3";
                                font-size: 13px;
                                font-weight: 700;
                                color: #3498db;
                            }
                        }
                    }
                    
                    Button {
                        text: "Fechar";
                        primary: true;
                        clicked => {
                            root.close();
                        }
                    }
                }
            }
        }
    }
}
